summary: Powerful, lightweight programming language
git-url: https://github.com/lua/lua
web-url: https://www.lua.org/
src-url: https://www.lua.org/ftp/lua-5.4.6.tar.gz
src-sha: 7d5ea1b9cb6aa0b59ca3dde1c6adcb57ef83a1ba8e5432c0ecd06bf439b3ad88
license: MIT
bscript: src

dosetup: |
    case $TARGET_PLATFORM_NAME in
        macos)  PLAT=macosx ;;
        linux)  PLAT=linux  ;;
    esac

install: |
    gmakew clean
    gmakew liblua.a "PLAT=$PLAT" CC="$CC" AR="'$AR crs'" RANLIB="$RANLIB" CFLAGS="'$CFLAGS -std=c99 -DLUA_COMPAT_5_3 $CPPFLAGS'"
    run "$CC" -shared "$CFLAGS" "$LDFLAGS" -o liblua$SHARED_LIBRARY_SUFFIX *.o
    install_libs liblua.a liblua$SHARED_LIBRARY_SUFFIX
    install_incs lua.h luaconf.h lualib.h lauxlib.h lua.hpp

dotweak: |
    writepc lua <<EOF
    prefix=\${pcfiledir}/../..
    exec_prefix=\${prefix}
    libdir=\${exec_prefix}/lib
    includedir=\${prefix}/include

    Name: Lua
    Description: $PACKAGE_SUMMARY
    Version: $PACKAGE_VERSION
    Cflags: -I\${includedir}
    Libs: -L\${libdir} -llua
    EOF
